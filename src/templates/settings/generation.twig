{% extends "translation-manager/_layouts/settings" %}
{% set title = "File Generation"|t('translation-manager') %}
{% set fullPageForm = true %}
{% set selectedSettingsItem = 'generation' %}

{% set plugin = craft.app.plugins.getPlugin('translation-manager') %}
{% set crumbs = [
    {
        label: plugin.settings.pluginName|t('translation-manager'),
        url: url('translation-manager'),
    },
    {
        label: 'Settings'|t('translation-manager'),
        url: url('translation-manager/settings'),
    },
    {
        label: 'File Generation'|t('translation-manager'),
        url: url('translation-manager/settings/generation'),
    },
] %}

{% import "_includes/forms" as forms %}

{% block content %}
	<form method="post" accept-charset="UTF-8">
		{{ csrfInput() }}
		{{ actionInput('translation-manager/settings/save') }}
		{{ redirectInput('translation-manager/settings/generation') }}
		{{ hiddenInput('section', 'generation') }}

		<h2>{{ "File Generation Settings"|t('translation-manager') }}</h2>

		{{ forms.lightswitchField({
            label: "Auto Generate"|t('translation-manager'),
            instructions: "Automatically generate translation files when translations are saved"|t('translation-manager'),
            id: 'autoExport',
            name: 'settings[autoExport]',
            on: settings.autoExport,
            disabled: settings.isOverriddenByConfig('autoExport'),
            warning: settings.isOverriddenByConfig('autoExport') ?
                "This is being overridden by the <code>autoExport</code> setting in <code>config/translation-manager.php</code>."|raw : null,
        }) }}

		{{ forms.autosuggestField({
            label: "Generation Path"|t('translation-manager'),
            instructions: "The path where PHP translation files should be generated for Craft to read"|t('translation-manager'),
            tip: "Use Craft path aliases: <code>@root/translations/translation-manager</code> or <code>@translations/translation-manager</code> (Craft's default translations folder). Paths must be outside webroot for security. Environment variables like <code>$ENV_VAR</code> are supported."|t('translation-manager')|raw,
            id: 'exportPath',
            name: 'settings[exportPath]',
            value: settings.exportPath,
            errors: settings.getErrors('exportPath'),
            required: true,
            suggestEnvVars: true,
            disabled: settings.isOverriddenByConfig('exportPath'),
            warning: settings.isOverriddenByConfig('exportPath') ?
                "This is being overridden by the <code>exportPath</code> setting in <code>config/translation-manager.php</code>."|raw : null,
        }) }}

		<div class="buttons">
			<button type="submit" class="btn submit">{{ "Save"|t('translation-manager') }}</button>
		</div>
	</form>

	{% set generationPath = settings.getExportPath() %}
	<div style="margin-top: 2rem; padding: 1rem; background: #f3f4f6; border-radius: 4px;">
		<p class="light" style="margin: 0; display: flex; align-items: flex-start; gap: 8px;">
			<svg aria-hidden="true" width="16" height="16" viewbox="0 0 16 16" style="flex-shrink: 0; margin-top: 2px;">
				<circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/>
				<text x="8" y="12" text-anchor="middle" font-size="11" font-weight="bold" fill="currentColor">i</text>
			</svg>
			<span>
				<strong>{{ "Generation Location:"|t('translation-manager') }}</strong>
				<code>{{ generationPath }}</code>
			</span>
		</p>
	</div>

	{% include 'translation-manager/_components/plugin-credit.twig' %}
{% endblock %}
